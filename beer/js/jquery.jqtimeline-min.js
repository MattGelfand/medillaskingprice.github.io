(function(e){function i(r,i){this.options=e.extend({},n,i);this.$el=e(r);this._defaults=n;this._name=t;this._offset_x=14;this._current_offset_x=14;this._gap=this.options.gap;this._eDotWidth=16;this._$toolTip=null;this._a$Events=[];this._aEvents=[];this._counter=0;this.$mainContainer;this.init()}var t="jqTimeline",n={startYear:(new Date).getFullYear()-1,numYears:3,gap:25,showToolTip:!0,groupEventWithinPx:6,events:[],click:null},r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];i.prototype.init=function(){_this=this;this._generateMarkup();_this.options.click&&_this.$mainContainer.on("click",function(t){var n=e(t.target);if(n.hasClass("event")||n.hasClass("msg")){var r=n.attr("id").split("_")[1];_this.options.click(t,_this._aEvents[r])}if(n.hasClass("closeTooltip")){var r=n.attr("id").split("_")[1],i=e("#"+r);_this._addEventListner(i,"mouseleave");var s=e("#tooltip_"+r);s.remove()}})};i.prototype._generateMarkup=function(){var t=this,n=0,r=0,i=t.options.numYears*this._gap*12+3,s=i+30,o=this.$mainContainer=e('<div class="gt-timeline" style="width:'+s+'px">'+'<div class="main_line" style="width:'+i+'px"></div>'+"</div>");for(r=0;r<t.options.numYears;r++)for(n=0;n<12;n++)o.append(t._getMonthMarkup(n,t.options.startYear+r));o.append(t._getMonthMarkup(0,t.options.startYear+t.options.numYears));for(var u=0;u<t.options.events.length;u++){var a=t.options.events[u],f=a.on;f.getFullYear()>=t.options.startYear&&f.getFullYear()<t.options.startYear+t.options.numYears&&o.append(t._getEventMarkup(a))}t.$el.append(o)};i.prototype._getMonthMarkup=function(e,t){var n=this,i="";e==0?i='<div class="horizontal-line leftend" style="left:'+n._current_offset_x+'px">'+'<div class="year">'+t+"</div>"+'<div class="month">Jan</div>'+"</div>":e%2==1?i='<div class="horizontal-line month-line odd-month" style="left:'+n._current_offset_x+'px"></div>':i='<div class="horizontal-line month-line even-month" style="left:'+n._current_offset_x+'px"><div class="month">'+r[e]+"</div></div>";n._current_offset_x+=n._gap;return i};i.prototype._getGenId=function(){var e=this;while(e._counter in this._aEvents)e._counter++;return e._counter};i.prototype._showToolTip=function(t,n,r,i){var s=this;s._$toolTip=e('<div class="e-message" id="tooltip_'+r+'" style="left:'+t+'px">'+'<div class="message-pointer"></div>'+n+"</div>");s.$mainContainer.append(s._$toolTip)};i.prototype._getAllNeighborEvents=function(t){var n=this,r=e(".event",n.$mainContainer).filter(function(){var r=parseInt(e(this).css("left"));return r<=t+n.options.groupEventWithinPx&&r>=t-n.options.groupEventWithinPx});return r};i.prototype._getEventMarkup=function(t){var n=this;typeof t.id=="undefined"&&(t.id=n._getGenId());n._aEvents[t.id]=t;var r=t.name,i=t.on,s=i.getDate(),o=i.getFullYear()-n.options.startYear,u=i.getMonth(),a=o*12+u,f=Math.ceil(n._offset_x+a*n.options.gap+n.options.gap/31*s-n._eDotWidth/2),l=e('<div class="event" id="event_'+t.id+'" style="left:'+f+'px">&nbsp;</div>').data("event",t);l.data("eventInfo",n._aEvents[t.id]);n.options.click&&n._addEventListner(l,"click");if(n.options.showToolTip){n._addEventListner(l,"mouseover");n._addEventListner(l,"mouseleave")}n._a$Events[t.id]=l;return l};i.prototype._addEventListner=function(t,n){var r=this;n=="mouseover"&&t.mouseover(function(t){var n=e(t.target),i=parseInt(n.css("left")),s=n.data("event");if(r._$toolTip){if(r._$toolTip.data("state")&&r._$toolTip.data("state")==="static"){var o=r._$toolTip.data("eventId"),u=e("#"+o);r._addEventListner(u,"mouseleave");r._$toolTip.data("state","dynamic")}r._$toolTip.remove()}var a=r._getAllNeighborEvents(i),f="";for(var l=0;l<a.length;l++){var c=e(a[l]),h=c.data("event");f=f+'<div class="msg" id="msg_'+h.id+'">'+h.on.toDateString()+" : "+h.name+"</div>"}r._showToolTip(i,f,s.id,!1)});n=="mouseleave"&&t.mouseleave(function(t){var n=e(this),r=n.data("event").id,i=e("#tooltip_"+r);t.stopImmediatePropagation();var s=setTimeout(function(){i.remove()},500);i.hover(function(){clearTimeout(s)},function(){i.remove()})});n=="click"&&t.click(function(n){var r=e(this),i=r.data("event").id,s=e("#tooltip_"+i),o=e(".msg",s);if(o.length!=1&&o.length>1){n.stopPropagation();var u=e('<div class="info"><div>Select one even from below : </div><div class="icon-close closeTooltip" id="eCloseButton_'+i+'"></div>'+"</div>");s.prepend(u);t.off("mouseleave");s.data("state","static");s.data("eventId",i)}})};var s=function(e){return Object.prototype.toString.apply(e)==="[object Array]"};i.prototype.addEvent=function(t){var n=[],r=0;n=e.isArray(t)?t:[t];for(r=0;r<n.length;r++){var i=this._getEventMarkup(n[r]);this.$mainContainer.append(i)}};i.prototype.deleteEvent=function(e){var t=this;if(typeof e=="undefined")return;var n=[],r;typeof e=="number"||typeof e=="string"?n=[e]:s(e)?n=e:n=[e];for(r=0;r<n.length;r++){var i=n[r];if(typeof i=="object"){if(typeof i.id=="undefined")continue;i=i.id}var o=t._a$Events[i];if(typeof o=="undefined")continue;o.remove();delete t._a$Events[i];delete t._aEvents[i]}};i.prototype.getAllEvents=function(){var e=this,t=[];for(key in e._aEvents)t.push(e._aEvents[key]);return t};i.prototype.getAllEventsElements=function(){var e=this,t=[];for(key in e._a$Events)t.push(e._a$Events[key]);return this._a$Events};e.fn.jqtimeline=function(t){return this.each(function(){var n=e(this);if(n.data("timeline"))return;var r=new i(this,t);n.data("jqtimeline",r)})}})(jQuery,window);